/*!
jQuery smallipop plugin
@name jquery.smallipop.js
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 0.6.0
@date 2013-06-14
@category jQuery plugin
@copyright (c) 2011-2013 Small Improvements (http://www.small-improvements.com)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
(function(t){return"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){var e,n,i,o,a,r,d,s,u,l,p,f,c,h,g,v,m,T,C,b,y,w,x,I,A,H,O,S,k,D,P,z,N,E,M,B,L,j,Q,Z,F,Y,q,R,W,X,G,J,K,U,V,$,_,te,ee,ne,ie,oe,ae,re,de,se,ue,le,pe,fe,ce,he,ge,ve,me,Te,Ce,be,ye,we,xe,Ie,Ae,He,Oe,Se,ke,De,Pe,ze,Ne,Ee;return s="smallipop",l=s+"-hint",f=s+"-instance",u=s+"-content",c=s+"-left",h=s+"-right",r=s+"-align-left",d=s+"-align-right",a=s+"-align-bottom",p=s+"-initialized",g=s+"-theme-",v=s+"-tour",C=v+"-content",w=v+"-overlay",b=v+"-footer",T=v+"-close-icon",I=v+"-progress",m=v+"-close",x=v+"-prev",y=v+"-next",F="focus."+s,Z="click."+s,Q="blur."+s,q="mouseout."+s,R="mouseover."+s,G="touchend."+s,W="resize."+s,X="scroll."+s,Y="keyup."+s,L=s+"OriginalZIndex",O=s+"BeingShown",z=s+"HideDelayTimer",N=s+"ShowDelayTimer",E=s+"TriggerHovered",k=s+"PopupHovered",P=s+"Shown",D=s+"Position",M=s+"XDistance",B=s+"YDistance",S=s+"IsTour",ge=RegExp(s+"-alignw+","g"),ve=RegExp(s+"w+","g"),n=t(document),o=t(window),e=t("body"),i=null,ae={},ze={},H=null,se=1,le=1,ye=null,ue=0,Te=null,ce="<div class='"+f+"'><div class='"+u+"'/></div>",t.smallipop=He={version:"0.6.0",defaults:{autoscrollPadding:200,contentAnimationSpeed:150,cssAnimations:{enabled:!1,show:"animated fadeIn",hide:"animated fadeOut"},funcEase:"easeInOutQuad",handleInputs:!0,hideDelay:500,hideTrigger:!1,hideOnPopupClick:!0,hideOnTriggerClick:!0,infoClass:l,invertAnimation:!1,popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,popupAnimationSpeed:200,preferredPosition:"top",referencedSelector:null,theme:"default",touchSupport:!0,tourHighlight:!1,tourHighlightColor:"#222",tourHighlightFadeDuration:200,tourHighlightOpacity:.5,tourHighlightZIndex:9997,tourNavigationEnabled:!0,triggerAnimationSpeed:150,triggerOnClick:!1,onAfterHide:null,onAfterShow:null,onBeforeHide:null,onBeforeShow:null,onTourClose:null,onTourNext:null,onTourPrev:null,windowPadding:30,labels:{prev:"Prev",next:"Next",close:"Close",of:"of"}}},t.easing.easeInOutQuad||(t.easing.easeInOutQuad=function(t,e,n,i,o){return 1>(e/=o/2)?i/2*e*e+n:-i/2*(--e*(e-2)-1)+n}),Ce=function(){var t,e,n,i,o;o=[];for(n in ze)e=ze[n],o.push(function(){var n,o,a;for(a=[],n=0,o=e.length;o>n;n++)t=e[n],i=t.trigger,i.data(L)?a.push(i.css("zIndex",i.data(L))):a.push(void 0);return a}());return o},Oe="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.touch:void 0,A="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.cssanimations:void 0,ne=function(e){return t("."+(s+e))},ee=function(){return i||(i=t("<div id='"+w+"'/>").appendTo(e).fadeOut(0)),i},oe=function(t){return ee().fadeOut(t.tourHighlightFadeDuration),Ce()},ie=function(e){var n,i,o,a,r,d,u,l,p,f,c,h,g,v,m,T,C;clearTimeout(ye),l=(null!=e?e.target:void 0)?t(e.target):e,C=[];for(d in ae)a=ae[d],r=a.data(),(u=r[P])&&(p=ne(u),f=p.is(l),(!r[S]||a.is(l)||f&&a.is(p.data(s).popupInstance))&&(p=ne(u),c=(null!=(m=p.data(s))?m.options:void 0)||He.defaults,r[S]&&(H=null,null!=(T=p.data(s))&&"function"==typeof(v=T.options).onTourClose&&v.onTourClose(),oe(c)),o=!c.hideOnTriggerClick&&f,i=!c.hideOnPopupClick&&a.find(l).length,l&&p.length&&"click"===(null!=e?e.type:void 0)&&(o||i)||(u&&c.hideTrigger&&p.stop(!0).fadeTo(c.triggerAnimationSpeed,1),a.data(z,null).data(O,!1),c.cssAnimations.enabled?(a.removeClass(c.cssAnimations.show).addClass(c.cssAnimations.hide).data(P,""),c.onAfterHide?C.push(window.setTimeout(c.onAfterHide,c.popupAnimationSpeed)):C.push(void 0)):(n=c.invertAnimation?-1:1,h=r[M]*n,g=r[B]*n,C.push(a.stop(!0).animate({top:"-="+g,left:"+="+h,opacity:0},c.popupAnimationSpeed,c.funcEase,function(){var e;return e=t(this),e.data(O)||e.css("display","none").data(P,""),"function"==typeof c.onAfterHide?c.onAfterHide():void 0}))))));return C},Ie=function(e){var n,i;return(n=t(this).data(s))?(n.popupInstance.data(P)===n.id||"checkbox"!==(i=!n.type)&&"radio"!==i||null!=e&&e.preventDefault(),Ee.call(this)):void 0},de=function(t){return clearTimeout(t.data(z)),clearTimeout(t.data(N))},he=function(t){return null==t&&(t=50),clearTimeout(Te),Te=setTimeout(me,t)},$=function(t,e){return t?(t.match(e)||[]).join(" "):void 0},U=function(t,e){return $(e,ge)},V=function(t,e){return $(e,ve)},me=function(e){var n,i,o,u,l,p,v,m,T,C,b,y,w,x,I,A,H,S,k,z,N,E,L,j,Q,Z,F,Y,q,R,W,X,G,K,V,$,_,te;null==e&&(e=!0),te=[];for(w in ae)l=ae[w],v=l.data(),E=v[P],E&&(j=ne(E),Q=j.data(s),u=Q.options,l.removeClass(U),e&&(L=g+u.theme.split(" ").join(" "+g),l.attr("class",""+f+" "+L)),Z=t(window),X=V=u.popupDistance,G=u.popupOffset,$=u.popupYOffset,n="fixed"===l.data(D),y=l.outerHeight(),A=l.outerWidth(),p=A/2,R=Z.width(),F=Z.height(),q=Z.scrollTop(),Y=Z.scrollLeft(),W=u.windowPadding,i=j.offset(),z=j.outerWidth(),k=j.outerHeight(),N=i.top-q,x=i.left+z/2,I=i.top-y+$,H=y+u.popupDistance-$,b=N-H,m=F-N-k-H,T=i.left-A-G,C=R-i.left-z-A,S=u.preferredPosition,"left"===S||"right"===S?(V=0,I+=k/2+y/2,"right"===S&&C>W||W>T?(l.addClass(h),x=i.left+z+G):(l.addClass(c),x=i.left-A-G,X=-X)):(X=0,x+p>R-W?(x-=2*p-G,l.addClass(r)):W>x-p?(x-=G,l.addClass(d)):x-=p,W>x&&(x=W),("bottom"===S&&m>W||W>b)&&(V=-V,I+=y+k-2*$,l.addClass(a))),k>y&&(_=I+y+W-V+$-q-F,_>0&&(I=Math.max(I-_-W,i.top+$+W+V))),z>A&&(K=x+A+W+X+G-Y-R,K>0&&(x=Math.max(x-K+W,i.left+G+W-X))),u.hideTrigger&&j.stop(!0).fadeTo(u.triggerAnimationSpeed,0),o=0,(!v[O]||u.cssAnimations.enabled)&&(I-=V,x+=X,X=0,V=0,o=1),n&&(x-=Y,I-=q),l.data(M,X).data(B,V).css({top:I,left:x,display:"block",opacity:o}),te.push(J(l,{top:"-="+V,left:"+="+X,opacity:1})));return te},_=function(){return me(!1)},J=function(t,e){var n,i;return n=(null!=(i=ne(t.data(P)).data(s))?i.options:void 0)||He.defaults,n.cssAnimations.enabled?(t.addClass(n.cssAnimations.show),window.setTimeout(function(){return K(t,n)},n.popupAnimationSpeed)):t.stop(!0).animate(e,n.popupAnimationSpeed,n.funcEase,function(){return K(t,n)})},K=function(t,e){var n;return n=t.data(),n[O]?(t.data(O,!1),"function"==typeof e.onAfterShow?e.onAfterShow(ne(n[P])):void 0):void 0},xe=function(e,n){var o,a,r,d,l,p,f,c,h;return null==n&&(n=""),c=e.data(s),h=c.options,r=c.popupInstance,r.data(E)?(p=r.data(P),p&&(o=ne(p),o.length&&(a=o.data(s).options||He.defaults,a.hideTrigger&&o.stop(!0).fadeTo(a.fadeSpeed,1))),h.tourHighlight&&h.tourIndex?(f=ee().css({backgroundColor:h.tourHighlightColor,zIndex:h.tourHighlightZIndex}),Ce(),"static"===e.css("position")&&e.css("position","relative"),e.data(L)||e.data(L,e.css("zIndex")),e.css("zIndex",h.tourHighlightZIndex+1),f.fadeTo(h.tourHighlightFadeDuration,h.tourHighlightOpacity)):i&&oe(h),d=n||c.hint,h.referencedContent&&!n&&(d=t(h.referencedContent).clone(!0,!0)||d),l=re(e)?"fixed":"absolute",p!==c.id&&r.hide(0),r.data(O,!0).data(P,c.id).data(D,l).find("."+u).empty().append(d),r.css("position",l),he(0)):void 0},re=function(t){var e;for(e=t;e.length&&"HTML"!==e[0].nodeName;){if("fixed"===e.css("position"))return!0;e=e.parent()}return!1},Ee=function(){var e,n,i,o,a,r;return o=n=t(this),e=o.hasClass(p),e||(o=ne(n.data(P))),o.length?(a=o.data(s),n=a.popupInstance.data(e?E:k,!0),de(n),i=n.data(P),i!==a.id||0===n.css("opacity")?("function"==typeof(r=a.options).onBeforeShow&&r.onBeforeShow(o),n.data(N,setTimeout(function(){return xe(o)},a.options.popupDelay))):void 0):void 0},Ne=function(){var e,n,i,o,a,r;return o=n=t(this),e=o.hasClass(p),e||(o=ne(n.data(P))),o.length?(a=o.data(s),n=a.popupInstance.data(e?E:k,!1),de(n),i=n.data(),i[k]||i[E]?void 0:("function"==typeof(r=a.options).onBeforeHide&&r.onBeforeHide(o),n.data(z,setTimeout(function(){return ie(n)},a.options.hideDelay)))):void 0},fe=function(){return clearTimeout(ye),ye=setTimeout(_,250)},we=function(e,n){var i,o,a;if(null!=e?e.length:void 0)return a=e.data(s),i=a.tourTitle,o=i?a.popupInstance.find("."+C):a.popupInstance.find("."+u),o.html()!==n?o.stop(!0).fadeTo(a.options.contentAnimationSpeed,0,function(){return t(this).html(n).fadeTo(a.options.contentAnimationSpeed,1),me()}):void 0},be=function(t,e){var n,i,o,a,r,d;if(a=t.data(s),o=null!=a?a.tourTitle:void 0,o&&ze[o])for(ze[o].sort(function(t,e){return t.index-e.index}),"number"!=typeof e||0!==e%1?e=-1:e-=1,H=o,n=ze[o],i=r=0,d=n.length-1;d>=0?d>=r:r>=d;i=d>=0?++r:--r)if(e>=0&&i===e||0>e&&n[i].id===a.id)return Pe(o,i)},Pe=function(e,n){var i,o,a,r,d,u,l;return(a=ze[e])?(o=a[n].trigger,l=o.data(s),u=l.options,d=u.tourNavigationEnabled,r="",d&&(r+="<div class='"+I+"'>"+(""+(n+1)+" "+u.labels.of+" "+a.length+"</div>"),n>0&&(r+="<a href='#' class='"+x+"'>"+u.labels.prev+"</a>"),a.length-1>n&&(r+="<a href='#' class='"+y+"'>"+u.labels.next+"</a>")),d&&n!==a.length-1||(r+="<a href='#' class='"+m+"'>"+u.labels.close+"</a>"),i=t("<div class='"+C+"'/>"+("<a href='#' class='"+T+"'>&Chi;</a>")+("<div class='"+b+"'>"+r+"</div>")),i.eq(0).append(l.hint),de(l.popupInstance),l.popupInstance.data(E,!0),Ae(o,i)):void 0},Ae=function(e,i){var a,r,d,u;return r=e.offset().top,a=r-n.scrollTop(),u=o.height(),d=e.data(s).options,!re(e)&&(d.autoscrollPadding>a||a>u-d.autoscrollPadding)?t("html, body").animate({scrollTop:r-u/2},800,"swing",function(){return xe(e,i)}):xe(e,i)},ke=function(t){var e,n,i,o,a,r,d;if(null!=t&&t.preventDefault(),n=ze[H])for(e=n[0].popupInstance,o=e.data(P)||n[0].id,i=r=0,d=n.length-2;d>=0?d>=r:r>=d;i=d>=0?++r:--r)if(n[i].id===o&&(a=n[i].trigger.data(s).options,a.tourNavigationEnabled))return"function"==typeof a.onTourNext&&a.onTourNext(n[i+1].trigger),Pe(H,i+1)},De=function(t){var e,n,i,o,a,r,d;if(null!=t&&t.preventDefault(),n=ze[H])for(e=n[0].popupInstance,o=e.data(P)||n[0].id,i=r=1,d=n.length-1;d>=1?d>=r:r>=d;i=d>=1?++r:--r)if(n[i].id===o&&(a=n[i].trigger.data(s).options,a.tourNavigationEnabled))return"function"==typeof a.onTourPrev&&a.onTourPrev(n[i-1].trigger),Pe(H,i-1)},Se=function(e){var n;return null!=e&&e.preventDefault(),n=t(e.target).closest("."+f),ie(n)},j=function(e){return e.each(function(){var e,n;return n=t(this),e=n.data(s),e?n.unbind("."+s).data(s,{}).removeClass(V):void 0})},pe=function(t){var e,n,i,o,a;switch(i="input"===(o=null!=t?t.target.tagName.toLowerCase():void 0)||"textarea"===o,t.which){case 27:a=[];for(n in ae)e=ae[n],a.push(ie(e));return a;case 37:if(!i)return De();break;case 39:if(!i)return ke()}},te=function(i,a){var r;return null==i&&(i="default"),null==a&&(a=!1),ae[i]?ae[i]:(r=t(ce).css("opacity",0).attr("id",""+(s+le++)).addClass(f).data(M,0).data(B,0).data(S,a).bind(R,Ee).bind(q,Ne),e.append(r),a?r.delegate("."+x,Z,De).delegate("."+y,Z,ke).delegate("."+m+", ."+T,Z,Se):r.delegate("a",Z,ie),2===le&&(n.bind(""+Z+" "+G,ie),o.bind(W,he).bind(X,fe).bind(Y,pe)),ae[i]=r)},t.fn.smallipop=function(e,n){var i;if(null==e&&(e={}),null==n&&(n=""),"string"==typeof e){switch(e.toLowerCase()){case"show":Ie.call(this.first().get(0));break;case"hide":ie(this.first().get(0));break;case"destroy":j(this);break;case"tour":be(this.first(),n);break;case"update":we(this.first(),n)}return this}return e=t.extend(!0,{},He.defaults,e),A||(e.cssAnimations.enabled=!1),i=te(),this.each(function(){var o,a,r,d,u,l,f,c,h,g,v,m,T,C,b;if(a=t(this),c=a[0].tagName.toLowerCase(),C=a.attr("type"),g=a.data(),u=n||a.attr("title"),o=t("> ."+e.infoClass+":first",a),o.length&&(u=o.clone(!0,!0).removeClass(e.infoClass)),u&&!a.hasClass(p)){d=se++,v={},T=i,m=t.extend(!0,{},e),"object"==typeof g[s]&&t.extend(!0,m,g[s]);for(l in g)b=g[l],l.indexOf(s)>=0&&(f=l.replace(s,""),f&&(f=f.substr(0,1).toLowerCase()+f.substr(1),m[f]=b));if(r=m.handleInputs&&("input"===c||"select"===c||"textarea"===c),m.tourIndex?(h=m.tourTitle||"defaultTour",m.hideOnTriggerClick=m.hideOnPopupClick=!1,T=te(h,!0),ze[h]||(ze[h]=[]),ze[h].push({index:m.tourIndex||0,id:d,trigger:a,popupInstance:T})):(r?(m.hideOnTriggerClick=!1,v[F]=Ee,v[Q]=Ne):v[q]=Ne,m.triggerOnClick||m.touchSupport&&Oe?v[Z]=Ie:(v[Z]=Ne,v[R]=Ee)),a.addClass(""+p+" "+s+d).attr("title","").data(s,{id:d,hint:u,options:m,tagName:c,type:C,tourTitle:h,popupInstance:T}).bind(v),!m.hideOnTriggerClick)return a.delegate("a",Z,ie)}})}});