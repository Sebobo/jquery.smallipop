/*!
jQuery smallipop plugin
@name jquery.smallipop.js
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 0.6.1
@date 2013-07-12
@category jQuery plugin
@copyright (c) 2011-2013 Small Improvements (http://www.small-improvements.com)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
(function(t){return"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){var e,n,o,i,a,r,d,s,u,l,p,f,c,h,g,v,m,T,C,b,y,w,x,I,A,H,O,S,k,D,P,z,N,E,M,B,L,j,F,Q,Z,Y,q,R,W,X,G,J,K,U,V,$,_,te,ee,ne,oe,ie,ae,re,de,se,ue,le,pe,fe,ce,he,ge,ve,me,Te,Ce,be,ye,we,xe,Ie,Ae,He,Oe,Se,ke,De,Pe,ze,Ne;return r="smallipop",u=r+"-hint",p=r+"-instance",s=r+"-content",f=r+"-left",c=r+"-right",d=r+"-bottom",i=r+"-align-left",a=r+"-align-right",l=r+"-initialized",h=r+"-theme-",g=r+"-tour",T=g+"-content",y=g+"-overlay",C=g+"-footer",m=g+"-close-icon",x=g+"-progress",v=g+"-close",w=g+"-prev",b=g+"-next",Q="focus."+r,F="click."+r,j="blur."+r,Y="mouseout."+r,q="mouseover."+r,X="touchend."+r,R="resize."+r,W="scroll."+r,Z="keyup."+r,B=r+"OriginalZIndex",H=r+"BeingShown",P=r+"HideDelayTimer",z=r+"ShowDelayTimer",N=r+"TriggerHovered",S=r+"PopupHovered",D=r+"Shown",k=r+"Position",E=r+"XDistance",M=r+"YDistance",O=r+"IsTour",he=RegExp(r+"-(align|bottom)w*","g"),ge=RegExp(r+"w+","g"),e=t(document),o=t(window),n=null,ie={},Pe={},A=null,de=1,ue=1,be=null,se=0,me=null,fe="<div class='"+p+"'><div class='"+s+"'/></div>",t.smallipop=Ae={version:"0.6.1",defaults:{autoscrollPadding:200,contentAnimationSpeed:150,cssAnimations:{enabled:!1,show:"animated fadeIn",hide:"animated fadeOut"},funcEase:"easeInOutQuad",handleInputs:!0,hideDelay:500,hideTrigger:!1,hideOnPopupClick:!0,hideOnTriggerClick:!0,infoClass:u,invertAnimation:!1,popupId:"",popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,popupAnimationSpeed:200,preferredPosition:"top",referencedContent:null,theme:"default",touchSupport:!0,tourHighlight:!1,tourHighlightColor:"#222",tourHighlightFadeDuration:200,tourHighlightOpacity:.5,tourHighlightZIndex:9997,tourNavigationEnabled:!0,triggerAnimationSpeed:150,triggerOnClick:!1,onAfterHide:null,onAfterShow:null,onBeforeHide:null,onBeforeShow:null,onTourClose:null,onTourNext:null,onTourPrev:null,windowPadding:30,labels:{prev:"Prev",next:"Next",close:"Close",of:"of"}}},t.easing.easeInOutQuad||(t.easing.easeInOutQuad=function(t,e,n,o,i){return 1>(e/=i/2)?o/2*e*e+n:-o/2*(--e*(e-2)-1)+n}),Te=function(){var t,e,n,o,i;i=[];for(n in Pe)e=Pe[n],i.push(function(){var n,i,a;for(a=[],n=0,i=e.length;i>n;n++)t=e[n],o=t.trigger,o.data(B)?a.push(o.css("zIndex",o.data(B))):a.push(void 0);return a}());return i},He="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.touch:void 0,I="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.cssanimations:void 0,ee=function(e){return t("."+(r+e))},te=function(){return n||(n=t("<div id='"+y+"'/>").appendTo(t("body")).fadeOut(0)),n},oe=function(t){return te().fadeOut(t.tourHighlightFadeDuration),Te()},ne=function(e){var n,o,i,a,d,s,u,l,p,f,c,h,g,v,m,T,C,b;clearTimeout(be),l=(null!=e?e.target:void 0)?t(e.target):e,b=[];for(s in ie)a=ie[s],d=a.data(),(u=d[D])&&(p=ee(u),c=p.is(l),f=p.data(r),h=f.options||Ae.defaults,(!d[O]&&!f.isFormElement||a.is(l)||c&&a.is(h.popupInstance))&&(d[O]&&(A=null,null!=(T=p.data(r))&&"function"==typeof(m=T.options).onTourClose&&m.onTourClose(),oe(h)),i=!h.hideOnTriggerClick&&c,o=!h.hideOnPopupClick&&a.find(l).length,(!l||!p.length||"click"!==(C=null!=e?e.type:void 0)&&"touchend"!==C||!i&&!o)&&(u&&h.hideTrigger&&p.stop(!0).fadeTo(h.triggerAnimationSpeed,1),a.data(P,null).data(H,!1),h.cssAnimations.enabled?(a.removeClass(h.cssAnimations.show).addClass(h.cssAnimations.hide).data(D,""),h.onAfterHide?b.push(window.setTimeout(h.onAfterHide,h.popupAnimationSpeed)):b.push(void 0)):(n=h.invertAnimation?-1:1,g=d[E]*n,v=d[M]*n,b.push(a.stop(!0).animate({top:"-="+v,left:"+="+g,opacity:0},h.popupAnimationSpeed,h.funcEase,function(){var e;return e=t(this),e.data(H)||e.css("display","none").data(D,""),"function"==typeof h.onAfterHide?h.onAfterHide():void 0}))))));return b},xe=function(e){var n,o;return(n=t(this).data(r))?(n.popupInstance.data(D)===n.id||"checkbox"!==(o=!n.type)&&"radio"!==o||null!=e&&e.preventDefault(),Ne.call(this)):void 0},re=function(t){return clearTimeout(t.data(P)),clearTimeout(t.data(z))},ce=function(t){return null==t&&(t=50),clearTimeout(me),me=setTimeout(ve,t)},V=function(t,e){return t?(t.match(e)||[]).join(" "):void 0},K=function(t,e){return V(e,he)},U=function(t,e){return V(e,ge)},ve=function(e){var n,o,s,u,l,g,v,m,T,C,b,y,w,x,I,A,O,S,P,z,N,B,L,j,F,Q,Z,Y,q,R,W,X,J,U,V,$,_,te;null==e&&(e=!0),te=[];for(w in ie)l=ie[w],v=l.data(),B=v[D],B&&(j=ee(B),F=j.data(r),u=F.options,l.removeClass(K),e&&(L=h+u.theme.split(" ").join(" "+h),l.attr("class",""+p+" "+L)),Q=t(window),X=V=u.popupDistance,J=u.popupOffset,$=u.popupYOffset,n="fixed"===l.data(k),y=l.outerHeight(),A=l.outerWidth(),g=A/2,R=Q.width(),Z=Q.height(),q=Q.scrollTop(),Y=Q.scrollLeft(),W=u.windowPadding,o=j.offset(),z=j.outerWidth(),P=j.outerHeight(),N=o.top-q,x=o.left+z/2,I=o.top-y+$,O=y+u.popupDistance-$,b=N-O,m=Z-N-P-O,T=o.left-A-J,C=R-o.left-z-A,S=u.preferredPosition,"left"===S||"right"===S?(V=0,I+=P/2+y/2,"right"===S&&C>W||W>T?(l.addClass(c),x=o.left+z+J):(l.addClass(f),x=o.left-A-J,X=-X)):(X=0,x+g>R-W?(x-=2*g-J,l.addClass(i)):W>x-g?(x-=J,l.addClass(a)):x-=g,W>x&&(x=W),("bottom"===S&&m>W||W>b)&&(V=-V,I+=y+P-2*$,l.addClass(d))),P>y&&(_=I+y+W-V+$-q-Z,_>0&&(I=Math.max(I-_-W,o.top+$+W+V))),z>A&&(U=x+A+W+X+J-Y-R,U>0&&(x=Math.max(x-U+W,o.left+J+W-X))),u.hideTrigger&&j.stop(!0).fadeTo(u.triggerAnimationSpeed,0),s=0,(!v[H]||u.cssAnimations.enabled)&&(I-=V,x+=X,X=V=0,s=1),n&&(x-=Y,I-=q),l.data(E,X).data(M,V).css({top:I,left:x,display:"block",opacity:s}),te.push(G(l,{top:"-="+V,left:"+="+X,opacity:1})));return te},$=function(){return ve(!1)},G=function(t,e){var n,o;return n=(null!=(o=ee(t.data(D)).data(r))?o.options:void 0)||Ae.defaults,n.cssAnimations.enabled?(t.addClass(n.cssAnimations.show),window.setTimeout(function(){return J(t,n)},n.popupAnimationSpeed)):t.stop(!0).animate(e,n.popupAnimationSpeed,n.funcEase,function(){return J(t,n)})},J=function(t,e){var n;return n=t.data(),n[H]?(t.data(H,!1),"function"==typeof e.onAfterShow?e.onAfterShow(ee(n[D])):void 0):void 0},we=function(e,o){var i,a,d,u,l,p,f,c,h;return null==o&&(o=""),c=e.data(r),h=c.options,d=c.popupInstance,d.data(N)?(p=d.data(D),p&&(i=ee(p),i.length&&(a=i.data(r).options||Ae.defaults,a.hideTrigger&&i.stop(!0).fadeTo(a.fadeSpeed,1))),h.tourHighlight&&h.tourIndex?(f=te().css({backgroundColor:h.tourHighlightColor,zIndex:h.tourHighlightZIndex}),Te(),"static"===e.css("position")&&e.css("position","relative"),e.data(B)||e.data(B,e.css("zIndex")),e.css("zIndex",h.tourHighlightZIndex+1),f.fadeTo(h.tourHighlightFadeDuration,h.tourHighlightOpacity)):n&&oe(h),u=o||c.hint,h.referencedContent&&!o&&(u=t(h.referencedContent).clone(!0,!0)||u),l=ae(e)?"fixed":"absolute",p!==c.id&&d.hide(0),d.data(H,!0).data(D,c.id).data(k,l).find("."+s).empty().append(u),d.css("position",l),ce(0)):void 0},ae=function(t){var e;for(e=t;e.length&&"HTML"!==e[0].nodeName;){if("fixed"===e.css("position"))return!0;e=e.parent()}return!1},Ne=function(){var e,n,o,i,a,d;return i=n=t(this),e=i.hasClass(l),e||(i=ee(n.data(D))),i.length?(a=i.data(r),n=a.popupInstance.data(e?N:S,!0),re(n),o=n.data(D),o!==a.id||0===n.css("opacity")?("function"==typeof(d=a.options).onBeforeShow&&d.onBeforeShow(i),n.data(z,setTimeout(function(){return we(i)},a.options.popupDelay))):void 0):void 0},ze=function(){var e,n,o,i,a,d;return i=n=t(this),e=i.hasClass(l),e||(i=ee(n.data(D))),i.length?(a=i.data(r),n=a.popupInstance.data(e?N:S,!1),re(n),o=n.data(),o[S]||o[N]?void 0:("function"==typeof(d=a.options).onBeforeHide&&d.onBeforeHide(i),n.data(P,setTimeout(function(){return ne(n)},a.options.hideDelay)))):void 0},pe=function(){return clearTimeout(be),be=setTimeout($,250)},ye=function(e,n){var o,i,a;if(null!=e?e.length:void 0)return a=e.data(r),o=a.tourTitle,i=o?a.popupInstance.find("."+T):a.popupInstance.find("."+s),i.html()!==n?i.stop(!0).fadeTo(a.options.contentAnimationSpeed,0,function(){return t(this).html(n).fadeTo(a.options.contentAnimationSpeed,1),ve()}):void 0},Ce=function(t,e){var n,o,i,a,d,s;if(a=t.data(r),i=null!=a?a.tourTitle:void 0,i&&Pe[i])for(Pe[i].sort(function(t,e){return t.index-e.index}),"number"!=typeof e||0!==e%1?e=-1:e-=1,A=i,n=Pe[i],o=d=0,s=n.length-1;s>=0?s>=d:d>=s;o=s>=0?++d:--d)if(e>=0&&o===e||0>e&&n[o].id===a.id)return De(i,o)},De=function(e,n){var o,i,a,d,s,u,l;return(a=Pe[e])?(i=a[n].trigger,l=i.data(r),u=l.options,s=u.tourNavigationEnabled,d="",s&&(d+="<div class='"+x+"'>"+(""+(n+1)+" "+u.labels.of+" "+a.length+"</div>"),n>0&&(d+="<a href='#' class='"+w+"'>"+u.labels.prev+"</a>"),a.length-1>n&&(d+="<a href='#' class='"+b+"'>"+u.labels.next+"</a>")),s&&n!==a.length-1||(d+="<a href='#' class='"+v+"'>"+u.labels.close+"</a>"),o=t("<div class='"+T+"'/>"+("<a href='#' class='"+m+"'>&Chi;</a>")+("<div class='"+C+"'>"+d+"</div>")),o.eq(0).append(l.hint),re(l.popupInstance),l.popupInstance.data(N,!0),Ie(i,o)):void 0},Ie=function(n,i){var a,d,s,u;return d=n.offset().top,a=d-e.scrollTop(),u=o.height(),s=n.data(r).options,!ae(n)&&(s.autoscrollPadding>a||a>u-s.autoscrollPadding)?t("html, body").animate({scrollTop:d-u/2},800,"swing",function(){return we(n,i)}):we(n,i)},Se=function(t){var e,n,o,i,a,d,s;if(null!=t&&t.preventDefault(),n=Pe[A])for(e=n[0].popupInstance,i=e.data(D)||n[0].id,o=d=0,s=n.length-2;s>=0?s>=d:d>=s;o=s>=0?++d:--d)if(n[o].id===i&&(a=n[o].trigger.data(r).options,a.tourNavigationEnabled))return"function"==typeof a.onTourNext&&a.onTourNext(n[o+1].trigger),De(A,o+1)},ke=function(t){var e,n,o,i,a,d,s;if(null!=t&&t.preventDefault(),n=Pe[A])for(e=n[0].popupInstance,i=e.data(D)||n[0].id,o=d=1,s=n.length-1;s>=1?s>=d:d>=s;o=s>=1?++d:--d)if(n[o].id===i&&(a=n[o].trigger.data(r).options,a.tourNavigationEnabled))return"function"==typeof a.onTourPrev&&a.onTourPrev(n[o-1].trigger),De(A,o-1)},Oe=function(e){var n;return null!=e&&e.preventDefault(),n=t(e.target).closest("."+p),ne(n)},L=function(e){return e.each(function(){var e,n;return n=t(this),e=n.data(r),e?n.unbind("."+r).data(r,{}).removeClass(U):void 0})},le=function(t){var e,n,o,i,a;switch(o="input"===(i=null!=t?t.target.tagName.toLowerCase():void 0)||"textarea"===i,t.which){case 27:a=[];for(n in ie)e=ie[n],a.push(ne(e));return a;case 37:if(!o)return ke();break;case 39:if(!o)return Se()}},_=function(n,i){var a;return null==n&&(n="default"),null==i&&(i=!1),ie[n]?ie[n]:(a=t(fe).css("opacity",0).attr("id",""+(r+ue++)).addClass(p).data(E,0).data(M,0).data(O,i).bind(q,Ne).bind(Y,ze),t("body").append(a),i?a.delegate("."+w,F,ke).delegate("."+b,F,Se).delegate("."+v+", ."+m,F,Oe):a.delegate("a",F,ne),2===ue&&(e.bind(""+F+" "+X,ne),o.bind(R,ce).bind(W,pe).bind(Z,le)),ie[n]=a)},t.fn.smallipop=function(e,n){var o;if(null==e&&(e={}),null==n&&(n=""),"string"==typeof e){switch(e.toLowerCase()){case"show":xe.call(this.first().get(0));break;case"hide":ne(this.first().get(0));break;case"destroy":L(this);break;case"tour":Ce(this.first(),n);break;case"update":ye(this.first(),n)}return this}return e=t.extend(!0,{},Ae.defaults,e),I||(e.cssAnimations.enabled=!1),o=_(e.popupId),this.each(function(){var i,a,d,s,u,p,f,c,h,g,v,m,T,C,b,y;if(a=t(this),c=a[0].tagName.toLowerCase(),b=a.attr("type"),v=a.data(),u=n||a.attr("title"),i=t("> ."+e.infoClass+":first",a),i.length&&(u=i.clone(!0,!0).removeClass(e.infoClass)),u&&!a.hasClass(l)){s=de++,m={},C=o,T=t.extend(!0,{},e),"object"==typeof v[r]&&t.extend(!0,T,v[r]);for(p in v)y=v[p],p.indexOf(r)>=0&&(f=p.replace(r,""),f&&(f=f.substr(0,1).toLowerCase()+f.substr(1),T[f]=y));if(d=T.handleInputs&&("input"===c||"select"===c||"textarea"===c),T.tourIndex?(g=T.tourTitle||"defaultTour",T.hideOnTriggerClick=T.hideOnPopupClick=!1,C=_(g,!0),Pe[g]||(Pe[g]=[]),Pe[g].push({index:T.tourIndex||0,id:s,trigger:a,popupInstance:C})):(h=T.touchSupport&&He,d?(T.hideOnTriggerClick=!1,m[Q]=Ne,m[j]=ze):h||(m[Y]=ze),T.triggerOnClick||h?m[F]=xe:(m[F]=ze,m[q]=Ne)),a.addClass(""+l+" "+r+s).attr("title","").data(r,{id:s,hint:u,options:T,tagName:c,type:b,tourTitle:g,popupInstance:C,isFormElement:d}).bind(m),!T.hideOnTriggerClick)return a.delegate("a",F,ne)}})}});