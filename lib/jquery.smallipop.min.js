/*!
jQuery smallipop plugin
@name jquery.smallipop.js
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 0.6.4
@date 2015-02-27
@category jQuery plugin
@copyright (c) 2011-2015 Small Improvements (http://www.small-improvements.com)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
!function(a){return"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb;return g="smallipop",j=g+"-hint",l=g+"-instance",i=g+"-content",m=g+"-left",n=g+"-right",h=g+"-bottom",e=g+"-align-left",f=g+"-align-right",k=g+"-initialized",o=g+"-theme-",p=g+"-tour",s=p+"-content",v=p+"-overlay",t=p+"-footer",r=p+"-close-icon",x=p+"-progress",q=p+"-close",w=p+"-prev",u=p+"-next",O="focus."+g,N="click."+g,M="blur."+g,Q="mouseout."+g,R="mouseover."+g,U="touchend."+g,S="resize."+g,T="scroll."+g,P="keyup."+g,K=g+"OriginalZIndex",A=g+"BeingShown",F=g+"HideDelayTimer",G=g+"ShowDelayTimer",H=g+"TriggerHovered",C=g+"PopupHovered",E=g+"Shown",D=g+"Position",I=g+"XDistance",J=g+"YDistance",B=g+"IsTour",ob=new RegExp(g+"-(align|bottom)w*","g"),pb=new RegExp(g+"w+","g"),b=a(document),d=a(window),c=null,eb={},Fb={},z=null,hb=1,jb=1,ub=null,ib=0,rb=null,mb="<div class='"+l+"'><div class='"+i+"'/></div>",a.smallipop=zb={version:"0.6.2",defaults:{autoscrollPadding:200,contentAnimationSpeed:150,cssAnimations:{enabled:!1,show:"animated fadeIn",hide:"animated fadeOut"},funcEase:"easeInOutQuad",handleInputs:!0,hideDelay:500,hideTrigger:!1,hideOnPopupClick:!0,hideOnTriggerClick:!0,infoClass:j,invertAnimation:!1,popupId:"",popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,popupAnimationSpeed:200,preferredPosition:"top",referencedContent:null,theme:"default",touchSupport:!0,tourHighlight:!1,tourHighlightColor:"#222",tourHighlightFadeDuration:200,tourHighlightOpacity:.5,tourHighlightZIndex:9997,tourNavigationEnabled:!0,triggerAnimationSpeed:150,triggerOnClick:!1,onAfterHide:null,onAfterShow:null,onBeforeHide:null,onBeforeShow:null,onTourClose:null,onTourNext:null,onTourPrev:null,windowPadding:30,labels:{prev:"Prev",next:"Next",close:"Close",of:"of"}}},a.easing.easeInOutQuad||(a.easing.easeInOutQuad=function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c}),sb=function(){var a,b,c,d,e;e=[];for(c in Fb)b=Fb[c],e.push(function(){var c,e,f;for(f=[],c=0,e=b.length;e>c;c++)a=b[c],d=a.trigger,f.push(d.data(K)?d.css("zIndex",d.data(K)):void 0);return f}());return e},Ab="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.touch:void 0,y="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.cssanimations:void 0,bb=function(b){return a("."+(g+b))},ab=function(){return c||(c=a("<div id='"+v+"'/>").appendTo(a("body")).fadeOut(0)),c},db=function(a){return ab().fadeOut(a.tourHighlightFadeDuration),sb()},cb=function(b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u;clearTimeout(ub),k=(null!=b?b.target:void 0)?a(b.target):b,u=[];for(i in eb)f=eb[i],h=f.data(),(j=h[E])&&(l=bb(j),n=l.is(k),m=l.data(g),o=m.options||zb.defaults,(!h[B]&&!m.isFormElement||f.is(k)||n&&f.is(o.popupInstance))&&(h[B]&&(z=null,null!=(s=l.data(g))&&"function"==typeof(r=s.options).onTourClose&&r.onTourClose(),db(o)),e=!o.hideOnTriggerClick&&n,d=!o.hideOnPopupClick&&f.find(k).length,(!k||!l.length||"click"!==(t=null!=b?b.type:void 0)&&"touchend"!==t||!e&&!d)&&(j&&o.hideTrigger&&l.stop(!0).fadeTo(o.triggerAnimationSpeed,1),f.data(F,null).data(A,!1),o.cssAnimations.enabled?(f.removeClass(o.cssAnimations.show).addClass(o.cssAnimations.hide).data(E,""),u.push(o.onAfterHide?window.setTimeout(o.onAfterHide,o.popupAnimationSpeed):void 0)):(c=o.invertAnimation?-1:1,p=h[I]*c,q=h[J]*c,u.push(f.stop(!0).animate({top:"-="+q,left:"+="+p,opacity:0},o.popupAnimationSpeed,o.funcEase,function(){var b;return b=a(this),b.data(A)||b.css("display","none").data(E,""),"function"==typeof o.onAfterHide?o.onAfterHide():void 0}))))));return u},xb=function(b){var c,d;return(c=a(this).data(g))?(c.popupInstance.data(E)===c.id||"checkbox"!==(d=!c.type)&&"radio"!==d||null!=b&&b.preventDefault(),Hb.call(this)):void 0},gb=function(a){return clearTimeout(a.data(F)),clearTimeout(a.data(G))},nb=function(a){return null==a&&(a=50),clearTimeout(rb),rb=setTimeout(qb,a)},Z=function(a,b){return a?(a.match(b)||[]).join(" "):void 0},X=function(a,b){return Z(b,ob)},Y=function(a,b){return Z(b,pb)},qb=function(b){var c,d,i,j,k,p,q,r,s,t,u,v,w,x,y,z,B,C,F,G,H,K,L,M,N,O,P,Q,R,S,T,U,W,Y,Z,$,_,ab;null==b&&(b=!0),ab=[];for(w in eb)k=eb[w],q=k.data(),K=q[E],K&&(M=bb(K),N=M.data(g),j=N.options,k.removeClass(X),b&&(L=o+j.theme.split(" ").join(" "+o),k.attr("class",""+l+" "+L)),O=a(window),U=Z=j.popupDistance,W=j.popupOffset,$=j.popupYOffset,c="fixed"===k.data(D),v=k.outerHeight(),z=k.outerWidth(),p=z/2,S=O.width(),P=O.height(),R=O.scrollTop(),Q=O.scrollLeft(),T=j.windowPadding,d=M.offset(),G=M.outerWidth(),F=M.outerHeight(),H=d.top-R,x=d.left+G/2,y=d.top-v+$,B=v+j.popupDistance-$,u=H-B,r=P-H-F-B,s=d.left-z-W,t=S-d.left-G-z,C=j.preferredPosition,"left"===C||"right"===C?(Z=0,y+=F/2+v/2,"right"===C&&t>T||T>s?(k.addClass(n),x=d.left+G+W):(k.addClass(m),x=d.left-z-W,U=-U)):(U=0,x+p>S-T?(x-=2*p-W,k.addClass(e)):T>x-p?(x-=W,k.addClass(f)):x-=p,T>x&&(x=T),("bottom"===C&&r>T||T>u)&&(Z=-Z,y+=v+F-2*$,k.addClass(h))),F>v&&(_=y+v+T-Z+$-R-P,_>0&&(y=Math.max(y-_-T,d.top+$+T+Z))),G>z&&(Y=x+z+T+U+W-Q-S,Y>0&&(x=Math.max(x-Y+T,d.left+W+T-U))),j.hideTrigger&&M.stop(!0).fadeTo(j.triggerAnimationSpeed,0),i=0,(!q[A]||j.cssAnimations.enabled)&&(y-=Z,x+=U,U=Z=0,i=1),c&&(x-=Q,y-=R),k.data(I,U).data(J,Z).css({top:y,left:x,display:"block",opacity:i}),ab.push(V(k,{top:"-="+Z,left:"+="+U,opacity:1})));return ab},$=function(){return qb(!1)},V=function(a,b){var c,d;return c=(null!=(d=bb(a.data(E)).data(g))?d.options:void 0)||zb.defaults,c.cssAnimations.enabled?(a.addClass(c.cssAnimations.show),window.setTimeout(function(){return W(a,c)},c.popupAnimationSpeed)):a.stop(!0).animate(b,c.popupAnimationSpeed,c.funcEase,function(){return W(a,c)})},W=function(a,b){var c;return c=a.data(),c[A]?(a.data(A,!1),"function"==typeof b.onAfterShow?b.onAfterShow(bb(c[E])):void 0):void 0},wb=function(b,d){var e,f,h,j,k,l,m,n,o;return null==d&&(d=""),n=b.data(g),o=n.options,h=n.popupInstance,h.data(H)?(l=h.data(E),l&&(e=bb(l),e.length&&(f=e.data(g).options||zb.defaults,f.hideTrigger&&e.stop(!0).fadeTo(f.fadeSpeed,1))),o.tourHighlight&&o.tourIndex?(m=ab().css({backgroundColor:o.tourHighlightColor,zIndex:o.tourHighlightZIndex}),sb(),"static"===b.css("position")&&b.css("position","relative"),b.data(K)||b.data(K,b.css("zIndex")),b.css("zIndex",o.tourHighlightZIndex+1),m.fadeTo(o.tourHighlightFadeDuration,o.tourHighlightOpacity)):c&&db(o),j=d||n.hint,o.referencedContent&&!d&&(j=a(o.referencedContent).clone(!0,!0)||j),k=fb(b)?"fixed":"absolute",l!==n.id&&h.hide(0),h.data(A,!0).data(E,n.id).data(D,k).find("."+i).empty().append(j),h.css("position",k),nb(0)):void 0},fb=function(a){var b;for(b=a;b.length&&"HTML"!==b[0].nodeName.toUpperCase();){if("fixed"===b.css("position"))return!0;b=b.parent()}return!1},Hb=function(){var b,c,d,e,f,h;return e=c=a(this),b=e.hasClass(k),b||(e=bb(c.data(E))),e.length?(f=e.data(g),c=f.popupInstance.data(b?H:C,!0),gb(c),d=c.data(E),d!==f.id||0===c.css("opacity")?("function"==typeof(h=f.options).onBeforeShow&&h.onBeforeShow(e),c.data(G,setTimeout(function(){return wb(e)},f.options.popupDelay))):void 0):void 0},Gb=function(){var b,c,d,e,f,h;return e=c=a(this),b=e.hasClass(k),b||(e=bb(c.data(E))),e.length?(f=e.data(g),c=f.popupInstance.data(b?H:C,!1),gb(c),d=c.data(),d[C]||d[H]?void 0:("function"==typeof(h=f.options).onBeforeHide&&h.onBeforeHide(e),c.data(F,setTimeout(function(){return cb(c)},f.options.hideDelay)))):void 0},lb=function(){return clearTimeout(ub),ub=setTimeout($,250)},vb=function(b,c){var d,e,f;if(null!=b?b.length:void 0)return f=b.data(g),d=f.tourTitle,e=f.popupInstance.find(d?"."+s:"."+i),e.html()!==c?e.stop(!0).fadeTo(f.options.contentAnimationSpeed,0,function(){return a(this).html(c).fadeTo(f.options.contentAnimationSpeed,1),qb()}):void 0},tb=function(a,b){var c,d,e,f,h,i;if(f=a.data(g),e=null!=f?f.tourTitle:void 0,e&&Fb[e])for(Fb[e].sort(function(a,b){return a.index-b.index}),"number"!=typeof b||b%1!==0?b=-1:b-=1,z=e,c=Fb[e],d=h=0,i=c.length-1;i>=0?i>=h:h>=i;d=i>=0?++h:--h)if(b>=0&&d===b||0>b&&c[d].id===f.id)return Eb(e,d)},Eb=function(b,c){var d,e,f,h,i,j,k;return(f=Fb[b])?(e=f[c].trigger,k=e.data(g),j=k.options,i=j.tourNavigationEnabled,h="",i&&(h+="<div class='"+x+"'>"+(""+(c+1)+" "+j.labels.of+" "+f.length+"</div>"),c>0&&(h+="<a href='#' class='"+w+"'>"+j.labels.prev+"</a>"),c<f.length-1&&(h+="<a href='#' class='"+u+"'>"+j.labels.next+"</a>")),i&&c!==f.length-1||(h+="<a href='#' class='"+q+"'>"+j.labels.close+"</a>"),d=a("<div class='"+s+"'/>"+("<a href='#' class='"+r+"'>&Chi;</a>")+("<div class='"+t+"'>"+h+"</div>")),d.eq(0).append(k.hint),gb(k.popupInstance),k.popupInstance.data(H,!0),yb(e,d)):void 0},yb=function(c,e){var f,h,i,j;return h=c.offset().top,f=h-b.scrollTop(),j=d.height(),i=c.data(g).options,!fb(c)&&(f<i.autoscrollPadding||f>j-i.autoscrollPadding)?a("html, body").animate({scrollTop:h-j/2},800,"swing",function(){return wb(c,e)}):wb(c,e)},Cb=function(a){var b,c,d,e,f,h,i;if(null!=a&&a.preventDefault(),c=Fb[z])for(b=c[0].popupInstance,e=b.data(E)||c[0].id,d=h=0,i=c.length-2;i>=0?i>=h:h>=i;d=i>=0?++h:--h)if(c[d].id===e&&(f=c[d].trigger.data(g).options,f.tourNavigationEnabled))return"function"==typeof f.onTourNext&&f.onTourNext(c[d+1].trigger),Eb(z,d+1)},Db=function(a){var b,c,d,e,f,h,i;if(null!=a&&a.preventDefault(),c=Fb[z])for(b=c[0].popupInstance,e=b.data(E)||c[0].id,d=h=1,i=c.length-1;i>=1?i>=h:h>=i;d=i>=1?++h:--h)if(c[d].id===e&&(f=c[d].trigger.data(g).options,f.tourNavigationEnabled))return"function"==typeof f.onTourPrev&&f.onTourPrev(c[d-1].trigger),Eb(z,d-1)},Bb=function(b){var c;return null!=b&&b.preventDefault(),c=a(b.target).closest("."+l),cb(c)},L=function(b){return b.each(function(){var b,c;return c=a(this),b=c.data(g),b?c.unbind("."+g).data(g,{}).removeClass(Y):void 0})},kb=function(a){var b,c,d,e,f;switch(d="input"===(e=null!=a?a.target.tagName.toLowerCase():void 0)||"textarea"===e,a.which){case 27:f=[];for(c in eb)b=eb[c],f.push(cb(b));return f;case 37:if(!d)return Db();break;case 39:if(!d)return Cb()}},_=function(c,e){var f;return null==c&&(c="default"),null==e&&(e=!1),eb[c]?eb[c]:(f=a(mb).css("opacity",0).attr("id",""+(g+jb++)).addClass(l).data(I,0).data(J,0).data(B,e).bind(R,Hb).bind(Q,Gb),a("body").append(f),e?f.delegate("."+w,N,Db).delegate("."+u,N,Cb).delegate("."+q+", ."+r,N,Bb):f.delegate("a",N,cb),2===jb&&(b.bind(""+N+" "+U,cb),d.bind(S,nb).bind(T,lb).bind(P,kb)),eb[c]=f)},a.fn.smallipop=function(b,c){var d;if(null==b&&(b={}),null==c&&(c=""),0===this.length)return this;if("string"==typeof b){switch(b.toLowerCase()){case"show":xb.call(this.first().get(0));break;case"hide":cb(this.first().get(0));break;case"destroy":L(this);break;case"tour":tb(this.first(),c);break;case"update":vb(this.first(),c)}return this}return b=a.extend(!0,{},zb.defaults,b),y||(b.cssAnimations.enabled=!1),d=_(b.popupId),this.each(function(){var e,f,h,i,j,l,m,n,o,p,q,r,s,t,u,v;if(f=a(this),n=f[0].tagName.toLowerCase(),u=f.attr("type"),q=f.data(),j=c||f.attr("title"),e=a("> ."+b.infoClass+":first",f),e.length&&(j=e.clone(!0,!0).removeClass(b.infoClass)),j&&!f.hasClass(k)){i=hb++,r={},t=d,s=a.extend(!0,{},b),"object"==typeof q[g]&&a.extend(!0,s,q[g]);for(l in q)v=q[l],l.indexOf(g)>=0&&(m=l.replace(g,""),m&&(m=m.substr(0,1).toLowerCase()+m.substr(1),s[m]=v));if(h=s.handleInputs&&("input"===n||"select"===n||"textarea"===n),s.tourIndex?(p=s.tourTitle||"defaultTour",s.hideOnTriggerClick=s.hideOnPopupClick=!1,t=_(p,!0),Fb[p]||(Fb[p]=[]),Fb[p].push({index:s.tourIndex||0,id:i,trigger:f,popupInstance:t})):(o=s.touchSupport&&Ab,h?(s.hideOnTriggerClick=!1,r[O]=Hb,r[M]=Gb):o||(r[Q]=Gb),s.triggerOnClick||o?r[N]=xb:(r[N]=Gb,r[R]=Hb)),f.addClass(""+k+" "+g+i).attr("title","").data(g,{id:i,hint:j,options:s,tagName:n,type:u,tourTitle:p,popupInstance:t,isFormElement:h}).bind(r),!s.hideOnTriggerClick)return f.delegate("a",N,cb)}})}});