/*!
jQuery smallipop plugin
@name jquery.smallipop.js
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 0.6.0
@date 2013-06-22
@category jQuery plugin
@copyright (c) 2011-2013 Small Improvements (http://www.small-improvements.com)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
(function(t){return"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){var e,n,i,o,a,r,d,u,s,l,p,f,c,h,g,v,m,T,C,b,y,w,x,I,A,H,O,S,k,D,P,z,N,E,M,B,L,j,Q,Z,F,Y,q,R,W,X,G,J,K,U,V,$,_,te,ee,ne,ie,oe,ae,re,de,ue,se,le,pe,fe,ce,he,ge,ve,me,Te,Ce,be,ye,we,xe,Ie,Ae,He,Oe,Se,ke,De,Pe,ze,Ne;return r="smallipop",s=r+"-hint",p=r+"-instance",u=r+"-content",f=r+"-left",c=r+"-right",d=r+"-bottom",o=r+"-align-left",a=r+"-align-right",l=r+"-initialized",h=r+"-theme-",g=r+"-tour",T=g+"-content",y=g+"-overlay",C=g+"-footer",m=g+"-close-icon",x=g+"-progress",v=g+"-close",w=g+"-prev",b=g+"-next",Z="focus."+r,Q="click."+r,j="blur."+r,Y="mouseout."+r,q="mouseover."+r,X="touchend."+r,R="resize."+r,W="scroll."+r,F="keyup."+r,B=r+"OriginalZIndex",H=r+"BeingShown",P=r+"HideDelayTimer",z=r+"ShowDelayTimer",N=r+"TriggerHovered",S=r+"PopupHovered",D=r+"Shown",k=r+"Position",E=r+"XDistance",M=r+"YDistance",O=r+"IsTour",he=RegExp(r+"-alignw+","g"),ge=RegExp(r+"w+","g"),e=t(document),i=t(window),n=null,oe={},Pe={},A=null,de=1,se=1,be=null,ue=0,me=null,fe="<div class='"+p+"'><div class='"+u+"'/></div>",t.smallipop=Ae={version:"0.6.0",defaults:{autoscrollPadding:200,contentAnimationSpeed:150,cssAnimations:{enabled:!1,show:"animated fadeIn",hide:"animated fadeOut"},funcEase:"easeInOutQuad",handleInputs:!0,hideDelay:500,hideTrigger:!1,hideOnPopupClick:!0,hideOnTriggerClick:!0,infoClass:s,invertAnimation:!1,popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,popupAnimationSpeed:200,preferredPosition:"top",referencedSelector:null,theme:"default",touchSupport:!0,tourHighlight:!1,tourHighlightColor:"#222",tourHighlightFadeDuration:200,tourHighlightOpacity:.5,tourHighlightZIndex:9997,tourNavigationEnabled:!0,triggerAnimationSpeed:150,triggerOnClick:!1,onAfterHide:null,onAfterShow:null,onBeforeHide:null,onBeforeShow:null,onTourClose:null,onTourNext:null,onTourPrev:null,windowPadding:30,labels:{prev:"Prev",next:"Next",close:"Close",of:"of"}}},t.easing.easeInOutQuad||(t.easing.easeInOutQuad=function(t,e,n,i,o){return 1>(e/=o/2)?i/2*e*e+n:-i/2*(--e*(e-2)-1)+n}),Te=function(){var t,e,n,i,o;o=[];for(n in Pe)e=Pe[n],o.push(function(){var n,o,a;for(a=[],n=0,o=e.length;o>n;n++)t=e[n],i=t.trigger,i.data(B)?a.push(i.css("zIndex",i.data(B))):a.push(void 0);return a}());return o},He="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.touch:void 0,I="undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.cssanimations:void 0,ee=function(e){return t("."+(r+e))},te=function(){return n||(n=t("<div id='"+y+"'/>").appendTo(t("body")).fadeOut(0)),n},ie=function(t){return te().fadeOut(t.tourHighlightFadeDuration),Te()},ne=function(e){var n,i,o,a,d,u,s,l,p,f,c,h,g,v,m,T,C,b;clearTimeout(be),l=(null!=e?e.target:void 0)?t(e.target):e,b=[];for(u in oe)a=oe[u],d=a.data(),(s=d[D])&&(p=ee(s),f=p.is(l),(!d[O]||a.is(l)||f&&a.is(p.data(r).popupInstance))&&(p=ee(s),c=(null!=(m=p.data(r))?m.options:void 0)||Ae.defaults,d[O]&&(A=null,null!=(T=p.data(r))&&"function"==typeof(v=T.options).onTourClose&&v.onTourClose(),ie(c)),o=!c.hideOnTriggerClick&&f,i=!c.hideOnPopupClick&&a.find(l).length,(!l||!p.length||"click"!==(C=null!=e?e.type:void 0)&&"touchend"!==C||!o&&!i)&&(s&&c.hideTrigger&&p.stop(!0).fadeTo(c.triggerAnimationSpeed,1),a.data(P,null).data(H,!1),c.cssAnimations.enabled?(a.removeClass(c.cssAnimations.show).addClass(c.cssAnimations.hide).data(D,""),c.onAfterHide?b.push(window.setTimeout(c.onAfterHide,c.popupAnimationSpeed)):b.push(void 0)):(n=c.invertAnimation?-1:1,h=d[E]*n,g=d[M]*n,b.push(a.stop(!0).animate({top:"-="+g,left:"+="+h,opacity:0},c.popupAnimationSpeed,c.funcEase,function(){var e;return e=t(this),e.data(H)||e.css("display","none").data(D,""),"function"==typeof c.onAfterHide?c.onAfterHide():void 0}))))));return b},xe=function(e){var n,i;return(n=t(this).data(r))?(n.popupInstance.data(D)===n.id||"checkbox"!==(i=!n.type)&&"radio"!==i||null!=e&&e.preventDefault(),Ne.call(this)):void 0},re=function(t){return clearTimeout(t.data(P)),clearTimeout(t.data(z))},ce=function(t){return null==t&&(t=50),clearTimeout(me),me=setTimeout(ve,t)},V=function(t,e){return t?(t.match(e)||[]).join(" "):void 0},K=function(t,e){return V(e,he)},U=function(t,e){return V(e,ge)},ve=function(e){var n,i,u,s,l,g,v,m,T,C,b,y,w,x,I,A,O,S,P,z,N,B,L,j,Q,Z,F,Y,q,R,W,X,J,U,V,$,_,te;null==e&&(e=!0),te=[];for(w in oe)l=oe[w],v=l.data(),B=v[D],B&&(j=ee(B),Q=j.data(r),s=Q.options,l.removeClass(K),e&&(L=h+s.theme.split(" ").join(" "+h),l.attr("class",""+p+" "+L)),Z=t(window),X=V=s.popupDistance,J=s.popupOffset,$=s.popupYOffset,n="fixed"===l.data(k),y=l.outerHeight(),A=l.outerWidth(),g=A/2,R=Z.width(),F=Z.height(),q=Z.scrollTop(),Y=Z.scrollLeft(),W=s.windowPadding,i=j.offset(),z=j.outerWidth(),P=j.outerHeight(),N=i.top-q,x=i.left+z/2,I=i.top-y+$,O=y+s.popupDistance-$,b=N-O,m=F-N-P-O,T=i.left-A-J,C=R-i.left-z-A,S=s.preferredPosition,"left"===S||"right"===S?(V=0,I+=P/2+y/2,"right"===S&&C>W||W>T?(l.addClass(c),x=i.left+z+J):(l.addClass(f),x=i.left-A-J,X=-X)):(X=0,x+g>R-W?(x-=2*g-J,l.addClass(o)):W>x-g?(x-=J,l.addClass(a)):x-=g,W>x&&(x=W),("bottom"===S&&m>W||W>b)&&(V=-V,I+=y+P-2*$,l.addClass(d))),P>y&&(_=I+y+W-V+$-q-F,_>0&&(I=Math.max(I-_-W,i.top+$+W+V))),z>A&&(U=x+A+W+X+J-Y-R,U>0&&(x=Math.max(x-U+W,i.left+J+W-X))),s.hideTrigger&&j.stop(!0).fadeTo(s.triggerAnimationSpeed,0),u=0,(!v[H]||s.cssAnimations.enabled)&&(I-=V,x+=X,X=0,V=0,u=1),n&&(x-=Y,I-=q),l.data(E,X).data(M,V).css({top:I,left:x,display:"block",opacity:u}),te.push(G(l,{top:"-="+V,left:"+="+X,opacity:1})));return te},$=function(){return ve(!1)},G=function(t,e){var n,i;return n=(null!=(i=ee(t.data(D)).data(r))?i.options:void 0)||Ae.defaults,n.cssAnimations.enabled?(t.addClass(n.cssAnimations.show),window.setTimeout(function(){return J(t,n)},n.popupAnimationSpeed)):t.stop(!0).animate(e,n.popupAnimationSpeed,n.funcEase,function(){return J(t,n)})},J=function(t,e){var n;return n=t.data(),n[H]?(t.data(H,!1),"function"==typeof e.onAfterShow?e.onAfterShow(ee(n[D])):void 0):void 0},we=function(e,i){var o,a,d,s,l,p,f,c,h;return null==i&&(i=""),c=e.data(r),h=c.options,d=c.popupInstance,d.data(N)?(p=d.data(D),p&&(o=ee(p),o.length&&(a=o.data(r).options||Ae.defaults,a.hideTrigger&&o.stop(!0).fadeTo(a.fadeSpeed,1))),h.tourHighlight&&h.tourIndex?(f=te().css({backgroundColor:h.tourHighlightColor,zIndex:h.tourHighlightZIndex}),Te(),"static"===e.css("position")&&e.css("position","relative"),e.data(B)||e.data(B,e.css("zIndex")),e.css("zIndex",h.tourHighlightZIndex+1),f.fadeTo(h.tourHighlightFadeDuration,h.tourHighlightOpacity)):n&&ie(h),s=i||c.hint,h.referencedContent&&!i&&(s=t(h.referencedContent).clone(!0,!0)||s),l=ae(e)?"fixed":"absolute",p!==c.id&&d.hide(0),d.data(H,!0).data(D,c.id).data(k,l).find("."+u).empty().append(s),d.css("position",l),ce(0)):void 0},ae=function(t){var e;for(e=t;e.length&&"HTML"!==e[0].nodeName;){if("fixed"===e.css("position"))return!0;e=e.parent()}return!1},Ne=function(){var e,n,i,o,a,d;return o=n=t(this),e=o.hasClass(l),e||(o=ee(n.data(D))),o.length?(a=o.data(r),n=a.popupInstance.data(e?N:S,!0),re(n),i=n.data(D),i!==a.id||0===n.css("opacity")?("function"==typeof(d=a.options).onBeforeShow&&d.onBeforeShow(o),n.data(z,setTimeout(function(){return we(o)},a.options.popupDelay))):void 0):void 0},ze=function(){var e,n,i,o,a,d;return o=n=t(this),e=o.hasClass(l),e||(o=ee(n.data(D))),o.length?(a=o.data(r),n=a.popupInstance.data(e?N:S,!1),re(n),i=n.data(),i[S]||i[N]?void 0:("function"==typeof(d=a.options).onBeforeHide&&d.onBeforeHide(o),n.data(P,setTimeout(function(){return ne(n)},a.options.hideDelay)))):void 0},pe=function(){return clearTimeout(be),be=setTimeout($,250)},ye=function(e,n){var i,o,a;if(null!=e?e.length:void 0)return a=e.data(r),i=a.tourTitle,o=i?a.popupInstance.find("."+T):a.popupInstance.find("."+u),o.html()!==n?o.stop(!0).fadeTo(a.options.contentAnimationSpeed,0,function(){return t(this).html(n).fadeTo(a.options.contentAnimationSpeed,1),ve()}):void 0},Ce=function(t,e){var n,i,o,a,d,u;if(a=t.data(r),o=null!=a?a.tourTitle:void 0,o&&Pe[o])for(Pe[o].sort(function(t,e){return t.index-e.index}),"number"!=typeof e||0!==e%1?e=-1:e-=1,A=o,n=Pe[o],i=d=0,u=n.length-1;u>=0?u>=d:d>=u;i=u>=0?++d:--d)if(e>=0&&i===e||0>e&&n[i].id===a.id)return De(o,i)},De=function(e,n){var i,o,a,d,u,s,l;return(a=Pe[e])?(o=a[n].trigger,l=o.data(r),s=l.options,u=s.tourNavigationEnabled,d="",u&&(d+="<div class='"+x+"'>"+(""+(n+1)+" "+s.labels.of+" "+a.length+"</div>"),n>0&&(d+="<a href='#' class='"+w+"'>"+s.labels.prev+"</a>"),a.length-1>n&&(d+="<a href='#' class='"+b+"'>"+s.labels.next+"</a>")),u&&n!==a.length-1||(d+="<a href='#' class='"+v+"'>"+s.labels.close+"</a>"),i=t("<div class='"+T+"'/>"+("<a href='#' class='"+m+"'>&Chi;</a>")+("<div class='"+C+"'>"+d+"</div>")),i.eq(0).append(l.hint),re(l.popupInstance),l.popupInstance.data(N,!0),Ie(o,i)):void 0},Ie=function(n,o){var a,d,u,s;return d=n.offset().top,a=d-e.scrollTop(),s=i.height(),u=n.data(r).options,!ae(n)&&(u.autoscrollPadding>a||a>s-u.autoscrollPadding)?t("html, body").animate({scrollTop:d-s/2},800,"swing",function(){return we(n,o)}):we(n,o)},Se=function(t){var e,n,i,o,a,d,u;if(null!=t&&t.preventDefault(),n=Pe[A])for(e=n[0].popupInstance,o=e.data(D)||n[0].id,i=d=0,u=n.length-2;u>=0?u>=d:d>=u;i=u>=0?++d:--d)if(n[i].id===o&&(a=n[i].trigger.data(r).options,a.tourNavigationEnabled))return"function"==typeof a.onTourNext&&a.onTourNext(n[i+1].trigger),De(A,i+1)},ke=function(t){var e,n,i,o,a,d,u;if(null!=t&&t.preventDefault(),n=Pe[A])for(e=n[0].popupInstance,o=e.data(D)||n[0].id,i=d=1,u=n.length-1;u>=1?u>=d:d>=u;i=u>=1?++d:--d)if(n[i].id===o&&(a=n[i].trigger.data(r).options,a.tourNavigationEnabled))return"function"==typeof a.onTourPrev&&a.onTourPrev(n[i-1].trigger),De(A,i-1)},Oe=function(e){var n;return null!=e&&e.preventDefault(),n=t(e.target).closest("."+p),ne(n)},L=function(e){return e.each(function(){var e,n;return n=t(this),e=n.data(r),e?n.unbind("."+r).data(r,{}).removeClass(U):void 0})},le=function(t){var e,n,i,o,a;switch(i="input"===(o=null!=t?t.target.tagName.toLowerCase():void 0)||"textarea"===o,t.which){case 27:a=[];for(n in oe)e=oe[n],a.push(ne(e));return a;case 37:if(!i)return ke();break;case 39:if(!i)return Se()}},_=function(n,o){var a;return null==n&&(n="default"),null==o&&(o=!1),oe[n]?oe[n]:(a=t(fe).css("opacity",0).attr("id",""+(r+se++)).addClass(p).data(E,0).data(M,0).data(O,o).bind(q,Ne).bind(Y,ze),t("body").append(a),o?a.delegate("."+w,Q,ke).delegate("."+b,Q,Se).delegate("."+v+", ."+m,Q,Oe):a.delegate("a",Q,ne),2===se&&(e.bind(""+Q+" "+X,ne),i.bind(R,ce).bind(W,pe).bind(F,le)),oe[n]=a)},t.fn.smallipop=function(e,n){var i;if(null==e&&(e={}),null==n&&(n=""),"string"==typeof e){switch(e.toLowerCase()){case"show":xe.call(this.first().get(0));break;case"hide":ne(this.first().get(0));break;case"destroy":L(this);break;case"tour":Ce(this.first(),n);break;case"update":ye(this.first(),n)}return this}return e=t.extend(!0,{},Ae.defaults,e),I||(e.cssAnimations.enabled=!1),i=_(),this.each(function(){var o,a,d,u,s,p,f,c,h,g,v,m,T,C,b,y;if(a=t(this),c=a[0].tagName.toLowerCase(),b=a.attr("type"),v=a.data(),s=n||a.attr("title"),o=t("> ."+e.infoClass+":first",a),o.length&&(s=o.clone(!0,!0).removeClass(e.infoClass)),s&&!a.hasClass(l)){u=de++,m={},C=i,T=t.extend(!0,{},e),"object"==typeof v[r]&&t.extend(!0,T,v[r]);for(p in v)y=v[p],p.indexOf(r)>=0&&(f=p.replace(r,""),f&&(f=f.substr(0,1).toLowerCase()+f.substr(1),T[f]=y));if(d=T.handleInputs&&("input"===c||"select"===c||"textarea"===c),T.tourIndex?(g=T.tourTitle||"defaultTour",T.hideOnTriggerClick=T.hideOnPopupClick=!1,C=_(g,!0),Pe[g]||(Pe[g]=[]),Pe[g].push({index:T.tourIndex||0,id:u,trigger:a,popupInstance:C})):(h=T.touchSupport&&He,d?(T.hideOnTriggerClick=!1,m[Z]=Ne,m[j]=ze):h&&(m[Y]=ze),T.triggerOnClick||h?m[Q]=xe:(m[Q]=ze,m[q]=Ne)),a.addClass(""+l+" "+r+u).attr("title","").data(r,{id:u,hint:s,options:T,tagName:c,type:b,tourTitle:g,popupInstance:C}).bind(m),!T.hideOnTriggerClick)return a.delegate("a",Q,ne)}})}});